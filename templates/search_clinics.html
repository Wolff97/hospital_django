{% extends 'base.html' %}
{% block content %}
<div class="container" style="margin-top: 20px;">
    <h2 style="text-align: center;">Clinics Deployment</h2>
    <div class="row" style="margin-top: 20px;">
        <div class="col-12">
        <div id="map-canvas" style="width:100%; height: 600px;"></div>
        </div>
    </div>
    
</div>

<script type="text/javascript">
    var gmarkers1 = [];
    var markers1 = [];
    var infowindow = new google.maps.InfoWindow({
        content: ''
    });
    // Our markers
    $(document).ready(function () {
        var token = '{{csrf_token}}';
        $.ajax({
            headers: { "X-CSRFToken": token },
            type: 'POST',
            url: "/clinics/all",
            data: {
            },
            success: function (data) {
                
                for(var i = 0;i<data.length;i++){
                    markers1[i] = data[i];
                }
                // console.log(markers1[0]);
                markerCount = markers1.length
                /** Function to init map */
                function initialize() {
                    var center = new google.maps.LatLng(-36.253218, 145.921097);
                    var mapOptions = {
                        zoom: 7,
                        center: center,
                        mapTypeId: google.maps.MapTypeId.TERRAIN
                    };

                    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
                    for (i = 0; i < markerCount; i++) {
                        addMarker(markers1[i]);
                    }
                }
                /** Function to add marker to map */
                function addMarker(marker) {
                    // var category = marker[4];
                    var title = marker[1];
                    var pos = new google.maps.LatLng(marker[6], marker[7]);
                    var content = `<div><a href="/clinics/clinic/` + marker[2] + `">` + marker[1] + `</a><p>`+marker[3]+`</p><p>`+marker[4]+`<p><p>`+marker[5]+`</p><div>`;
                    marker1 = new google.maps.Marker({
                        title: title,
                        position: pos,
                        // category: category,
                        map: map,
                        visibility: false
                    });

                    gmarkers1.push(marker1);

                    // Marker click listener
                    google.maps.event.addListener(marker1, 'click', (function (marker1, content) {
                        return function () {
                            console.log('Gmarker 1 gets pushed');
                            infowindow.setContent(content);
                            infowindow.open(map, marker1);
                            map.panTo(this.getPosition());
                            map.setZoom(15);
                        }
                    })(marker1, content));
                }
                // Init map
                initialize();
            }
        });
        
   });
</script>
{% endblock %}